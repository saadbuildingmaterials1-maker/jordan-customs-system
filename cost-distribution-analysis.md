# تحليل توزيع التكاليف من البيان الجمركي الأردني

## البيانات الأساسية:
- **رقم البيان**: 89430
- **قيمة البضاعة الإجمالية**: 20,100.00 دينار
- **الوزن الإجمالي**: 20,100.00 كغ

---

## جدول الرسوم والضرائب (من الجدول 47):

| الرمز | الوصف | قاعدة الاحتساب | الكمية | نسبة الرسم | القيمة المحسوبة |
|------|-------|----------------|--------|------------|-----------------|
| **001** | الرسوم | 20,100.00 | 0.00 | 0.000 | **0.00** |
| **020** | الضرائب (ضريبة المبيعات 16%) | 20,100.00 | 3,216.00 | 16.000 | **3,216.00** |
| **301** | رسم إضافي | 50.00 | 50.00 | 1.000 | **50.00** |
| **111** | رسم إضافي | 1,500.00 | 4.50 | 0.300 | **4.50** |
| **016** | رسم إضافي | 23.20 | 23.20 | 100.000 | **23.20** |
| **043** | رسم إضافي | 8.00 | 8.00 | 100.000 | **8.00** |
| **055** | رسم إضافي | 10.00 | 10.00 | 100.000 | **10.00** |
| **--** | باقي الرسوم | -- | 204.45 | -- | **204.45** |

---

## ملخص التكاليف (من الجدول 48):

### تفاصيل المحاسبة:
1. **مجموع قيمة البضاعة**: 20,100.00 دينار
2. **رقم الشحنة**: 195288
3. **رقم الموصل المحاسبي**: (فارغ)
4. **الرسوم على البيان**: 412.20 دينار
5. **مجموع الرسوم على البيان**: 3,928.35 دينار

### التوزيع التفصيلي:
- **رسوم الوحدة (10 بنود)**: 3,516.15 دينار
- **باقي الرسوم**: 204.45 دينار
- **المجموع الكلي**: 3,928.35 دينار

---

## معادلات الحساب الصحيحة:

### 1. ضريبة المبيعات (16%):
```
ضريبة المبيعات = قيمة البضاعة × 16%
ضريبة المبيعات = 20,100.00 × 0.16 = 3,216.00 دينار
```

### 2. الرسوم الإضافية:
```
رسم 301 = 50.00 دينار
رسم 111 = 4.50 دينار  
رسم 016 = 23.20 دينار
رسم 043 = 8.00 دينار
رسم 055 = 10.00 دينار
باقي الرسوم = 204.45 دينار
---
مجموع الرسوم الإضافية = 300.15 دينار
```

### 3. الرسوم على البيان:
```
الرسوم على البيان = 412.20 دينار
```

### 4. المجموع الكلي للرسوم:
```
المجموع = ضريبة المبيعات + الرسوم الإضافية + الرسوم على البيان
المجموع = 3,216.00 + 300.15 + 412.20 = 3,928.35 دينار
```

### 5. التكلفة النهائية الإجمالية:
```
التكلفة النهائية = قيمة البضاعة + مجموع الرسوم
التكلفة النهائية = 20,100.00 + 3,928.35 = 24,028.35 دينار
```

---

## توزيع التكاليف على الأصناف:

### المبدأ الأساسي:
يتم توزيع التكاليف على الأصناف بناءً على **نسبة قيمة كل صنف من القيمة الإجمالية**.

### مثال توضيحي:
لنفترض أن لدينا 3 أصناف في الحاوية:

| الصنف | القيمة | الوزن | النسبة من الإجمالي |
|-------|--------|-------|---------------------|
| صنف A | 10,000 | 10,000 كغ | 49.75% |
| صنف B | 8,000 | 7,000 كغ | 39.80% |
| صنف C | 2,100 | 3,100 كغ | 10.45% |
| **المجموع** | **20,100** | **20,100 كغ** | **100%** |

### توزيع ضريبة المبيعات (3,216.00):
```
صنف A = 3,216.00 × 49.75% = 1,600.00 دينار
صنف B = 3,216.00 × 39.80% = 1,280.00 دينار
صنف C = 3,216.00 × 10.45% = 336.00 دينار
```

### توزيع الرسوم الإضافية (300.15):
```
صنف A = 300.15 × 49.75% = 149.32 دينار
صنف B = 300.15 × 39.80% = 119.46 دينار
صنف C = 300.15 × 10.45% = 31.37 دينار
```

### توزيع الرسوم على البيان (412.20):
```
صنف A = 412.20 × 49.75% = 205.07 دينار
صنف B = 412.20 × 39.80% = 164.06 دينار
صنف C = 412.20 × 10.45% = 43.07 دينار
```

### التكلفة النهائية لكل صنف:
```
صنف A = 10,000 + 1,600.00 + 149.32 + 205.07 = 11,954.39 دينار
صنف B = 8,000 + 1,280.00 + 119.46 + 164.06 = 9,563.52 دينار
صنف C = 2,100 + 336.00 + 31.37 + 43.07 = 2,510.44 دينار
---
المجموع = 24,028.35 دينار ✓
```

---

## الحقول المطلوبة في قاعدة البيانات:

### جدول البيان الجمركي (customs_declarations):
```sql
- id
- declaration_number (رقم البيان)
- declaration_date (تاريخ البيان)
- container_id (ربط بالحاوية)
- importer_name (اسم المستورد)
- importer_tax_id (الرقم الضريبي)
- importer_phone (رقم الهاتف)
- customs_center (المركز الجمركي)
- total_goods_value (قيمة البضاعة الإجمالية)
- total_weight (الوزن الإجمالي)
- sales_tax_rate (نسبة ضريبة المبيعات - 16%)
- sales_tax_amount (قيمة ضريبة المبيعات)
- additional_fees (الرسوم الإضافية)
- declaration_fees (الرسوم على البيان)
- total_fees (مجموع الرسوم)
- grand_total (التكلفة النهائية الإجمالية)
- status (الحالة: draft, submitted, approved)
- created_at
- updated_at
```

### جدول أصناف البيان (declaration_items):
```sql
- id
- declaration_id (ربط بالبيان)
- item_code (رمز الصنف)
- item_description (وصف الصنف)
- hs_code (الرمز الجمركي)
- quantity (الكمية)
- unit (الوحدة)
- unit_price (سعر الوحدة)
- item_value (قيمة الصنف)
- item_weight (وزن الصنف)
- value_percentage (نسبة القيمة من الإجمالي)
- customs_duty_rate (نسبة الرسوم الجمركية)
- customs_duty_amount (قيمة الرسوم الجمركية)
- sales_tax_amount (ضريبة المبيعات الموزعة)
- additional_fees_distributed (الرسوم الإضافية الموزعة)
- declaration_fees_distributed (رسوم البيان الموزعة)
- total_item_cost (التكلفة النهائية للصنف)
- created_at
- updated_at
```

---

## خوارزمية التوزيع في النظام:

```javascript
function distributeCustomsCosts(declaration, items) {
  // 1. حساب النسبة المئوية لكل صنف
  items.forEach(item => {
    item.value_percentage = (item.item_value / declaration.total_goods_value) * 100;
  });

  // 2. توزيع ضريبة المبيعات
  items.forEach(item => {
    item.sales_tax_amount = (declaration.sales_tax_amount * item.value_percentage) / 100;
  });

  // 3. توزيع الرسوم الإضافية
  items.forEach(item => {
    item.additional_fees_distributed = (declaration.additional_fees * item.value_percentage) / 100;
  });

  // 4. توزيع رسوم البيان
  items.forEach(item => {
    item.declaration_fees_distributed = (declaration.declaration_fees * item.value_percentage) / 100;
  });

  // 5. حساب التكلفة النهائية لكل صنف
  items.forEach(item => {
    item.total_item_cost = item.item_value 
                         + item.sales_tax_amount 
                         + item.additional_fees_distributed 
                         + item.declaration_fees_distributed;
  });

  return items;
}
```

---

## ملاحظات مهمة:

1. **ضريبة المبيعات ثابتة**: 16% على قيمة البضاعة
2. **الرسوم الجمركية**: في هذا البيان = 0% (رمز 001 = 0.00)
3. **الرسوم الإضافية**: تختلف حسب نوع البضاعة
4. **التوزيع**: يتم حسب نسبة قيمة كل صنف من الإجمالي
5. **الدقة**: يجب التأكد من أن مجموع التكاليف الموزعة = التكلفة الإجمالية
